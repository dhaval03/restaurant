{{ header }}{{ column_left }}
<div id="content">
	<div class="page-header">
		<div class="container-fluid">
			<div class="float-end">
				<button type="submit" form="form-geo-zone" data-bs-toggle="tooltip" title="{{ button_save }}" class="btn btn-primary"><i class="fa fa-save"></i></button>
			<a href="{{ cancel }}" data-bs-toggle="tooltip" title="{{ button_cancel }}" class="btn btn-default btn-light"><i class="fa fa-reply"></i></a>
			{% if helpcheck %}
			<a href="{{ helplink }}" rel=”nofollow”  target="_blank" id="button-pts-help" class="btn"><img src="{{ helpimage }}" alt="Help" width="85" height="43"></a>
		    {% endif %}
			</div>
			<h1>{{ heading_title }}</h1>
			<ul class="breadcrumb">
				{% for breadcrumb in breadcrumbs %}
				<li class="breadcrumb-item"><a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a></li>
				{% endfor %}
			</ul>
		</div>
	</div>
	<div class="container-fluid"> 
	 {% if error_warning %}
    <div class="alert alert-danger alert-dismissible"><i class="fa fa-exclamation-circle"></i> {{ error_warning }}
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    {% endif %}
		<div class="panel panel-default card">
			<div class="panel-heading">
				<h3 class="panel-title card-header"><i class="fas fa-pencil-alt"></i> {{ text_form }}</h3>
			</div>
			<div class="panel-body card-body">
				<form action="{{ action }}" method="post" enctype="multipart/form-data" id="form-geo-zone" class="form-horizontal">
					<div class="form-group required row py-3">
						<label class="col-sm-2 control-label col-form-label" for="input-seller-name">{{ seller_name }}</label>
						<div class="col-sm-10">
							<select name="seller_id" id="input-filter_name" class="form-select">
								{% for seller_store in seller_stores %}
								{% if seller_store.vendor_id == vendor_id %}
								<option value="{{ seller_store.vendor_id }}" selected="selected">{{ seller_store.name }}</option>
								{% else %}
								<option value="{{ seller_store.vendor_id }}">{{ seller_store.name }}</option>
								{% endif %}
								{% endfor %}
							</select>
							{% if error_store_name %}
							<div class="text-danger">{{ error_store_name }}</div>
						{% endif %} </div>
					</div>         
					<div class="form-group required row py-3">
						<label class="col-sm-2 control-label col-form-label" for="input-name">{{ entry_name }}</label>
						<div class="col-sm-10">
							<input type="text" name="name" value="{{ name }}" placeholder="{{ entry_name }}" id="input-name" class="form-control" />
							{% if error_name %}
							<div class="text-danger">{{ error_name }}</div>
						{% endif %} </div>
					</div>
					<div class="form-group required row py-3">
						<label class="col-sm-2 control-label col-form-label" for="input-description">{{ entry_description }}</label>
						<div class="col-sm-10">
							<input type="text" name="description" value="{{ description }}" placeholder="{{ entry_description }}" id="input-description" class="form-control" />
							{% if error_description %}
							<div class="text-danger">{{ error_description }}</div>
						{% endif %} </div>
					</div>    
	                <div class="form-group required row py-3">
						<label class="col-sm-2 control-label col-form-label" for="input-weight-from">{{ entry_weight_from }}</label>
						<div class="col-sm-10">
							<input type="text" name="weight_from" value="{{ weight_from }}" placeholder="{{ entry_weight_from }}" id="input-weight-from" class="form-control" />
							{% if error_weight_from %}
							<div class="text-danger">{{ error_weight_from }}</div>
						{% endif %} </div>
					</div>
	                <div class="form-group required row py-3">
						<label class="col-sm-2 control-label col-form-label" for="input-weight-to">{{ entry_weight_to }}</label>
						<div class="col-sm-10">
							<input type="text" name="weight_to" value="{{ weight_to }}" placeholder="{{ entry_weight_to }}" id="input-weight-to" class="form-control" />
							{% if error_weight_to %}
							<div class="text-danger">{{ error_weight_to }}</div>
						{% endif %} </div>
					</div>					
					<div class="form-group required row py-3">
						<label class="col-sm-2 control-label col-form-label" for="input-price">{{ entry_price }}</label>
						<div class="col-sm-10">
							<input type="text" name="price" value="{{ price }}" placeholder="{{ entry_price }}" id="input-price" class="form-control" />
							{% if error_price %}
							<div class="text-danger">{{ error_price }}</div>
						{% endif %} </div>
					</div>
					<fieldset>
						<legend>{{ text_geo_zone }}</legend>
						<table id="zone-to-geo-zone" class="table table-striped table-bordered table-hover">
							<thead>
								<tr>
									<td class="text-start">{{ entry_country }}</td>
									<td class="text-start">{{ entry_zone }}</td>
									<td></td>
								</tr>
							</thead>
							<tbody>
								
								{% set zone_to_geo_zone_row = 0 %}
								{% for zone_to_geo_zone in zone_to_geo_zones %}
								<tr id="zone-to-geo-zone-row{{ zone_to_geo_zone_row }}">
									<td class="text-left"><select name="zone_to_geo_zone[{{ zone_to_geo_zone_row }}][country_id]" class="form-select" data-index="{{ zone_to_geo_zone_row }}" data-zone-id="{{ zone_to_geo_zone.zone_id }}" disabled="disabled">
										<option value="a">{{ text_select_country }}</option>
										{% for country in countries %}
										{% if country.country_id == zone_to_geo_zone.country_id %}
										
										<option value="{{ country.country_id }}" selected="selected">{{ country.name }}</option>
										
										{% else %}
										
										<option value="{{ country.country_id }}">{{ country.name }}</option>
										
										{% endif %}
										{% endfor %}
										
									</select></td>
									<td class="text-start"><select name="zone_to_geo_zone[{{ zone_to_geo_zone_row }}][zone_id]" class="form-select" disabled="disabled">
									</select></td>
									<td class="text-start"><button type="button" onclick="$('#zone-to-geo-zone-row{{ zone_to_geo_zone_row }}').remove();" data-bs-toggle="tooltip" title="{{ button_remove }}" class="btn btn-danger"><i class="fa fa-minus-circle"></i></button></td>
								</tr>
								{% set zone_to_geo_zone_row = zone_to_geo_zone_row + 1 %}
								{% endfor %}
							</tbody>
							
							<tfoot>
								<tr>
									<td colspan="2"></td>
									<td class="start"><button type="button" id="button-geo-zone" data-bs-toggle="tooltip" title="{{ button_geo_zone_add }}" class="btn btn-primary"><i class="fa fa-plus-circle"></i></button></td>
								</tr>
							</tfoot>
						</table>
					</fieldset>
				</form>
			</div>
		</div>
	</div>
	<script type="text/javascript"><!--
		
		var zone_to_geo_zone_row = {{ zone_to_geo_zone_row }};
		
		$('#button-geo-zone').on('click', function() {
			html  = '<tr id="zone-to-geo-zone-row' + zone_to_geo_zone_row + '">';
			html += '  <td class="text-left"><select name="zone_to_geo_zone[' + zone_to_geo_zone_row + '][country_id]" class="form-select" data-index="' + zone_to_geo_zone_row + '">';
			html += '<option value="a">{{ text_select_country }}</option>';
			{% for country in countries %}
			html += '    <option value="{{ country.country_id }}">{{ country.name|escape('js') }}</option>';
			{% endfor %}   
			html += '</select></td>';
			html += '  <td class="text-left"><select name="zone_to_geo_zone[' + zone_to_geo_zone_row + '][zone_id]" class="form-select"><option value="0">{{ text_all_zones }}</option></select></td>';
			html += '  <td class="text-left"><button type="button" onclick="$(\'#zone-to-geo-zone-row' + zone_to_geo_zone_row + '\').remove();" data-toggle="tooltip" title="{{ button_remove }}" class="btn btn-danger"><i class="fa fa-minus-circle"></i></button></td>';
			html += '</tr>';
			
			$('#zone-to-geo-zone tbody').append(html);
			
			$('zone_to_geo_zone[' + zone_to_geo_zone_row + '][country_id]').trigger();
			
			zone_to_geo_zone_row++;
		});
		
		$('#zone-to-geo-zone').on('change', 'select[name$=\'[country_id]\']', function() {
			var element = this;
			
			if (element.value) { 
				$.ajax({
					url: 'index.php?route=localisation/country|country&user_token={{ user_token }}&country_id=' + element.value,
					dataType: 'json',
					beforeSend: function() {
						$(element).prop('disabled', true);
						$('button[form=\'form-geo-zone\']').prop('disabled', true);
					},
					complete: function() {
						$(element).prop('disabled', false);
						$('button[form=\'form-geo-zone\']').prop('disabled', false);
					},
					success: function(json) {
						html = '<option value="0">{{ text_all_zones }}</option>';
						
						if (json['zone'] && json['zone'] != '') {	
							for (i = 0; i < json['zone'].length; i++) {
								html += '<option value="' + json['zone'][i]['zone_id'] + '"';
								
								if (json['zone'][i]['zone_id'] == $(element).attr('data-zone-id')) {
									html += ' selected="selected"';
								}
								
								html += '>' + json['zone'][i]['name'] + '</option>';
							}
						}
						
						$('select[name=\'zone_to_geo_zone[' + $(element).attr('data-index') + '][zone_id]\']').html(html);
						
						$('select[name=\'zone_to_geo_zone[' + $(element).attr('data-index') + '][zone_id]\']').prop('disabled', false);
						
						$('select[name$=\'[country_id]\']:disabled:first').trigger('change');
					},
					error: function(xhr, ajaxOptions, thrownError) {
						alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
					}
				});
			}
		});
		
		$('select[name$=\'[country_id]\']:disabled:first').trigger('change');
	//--></script></div>
	{{ footer }}	